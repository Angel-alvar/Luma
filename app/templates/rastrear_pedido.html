<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Rastrear Pedido | Luma</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/estiloinicio.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/headerfooter.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pedidostyle.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon-32x32.png') }}">
    <style>
        .estado-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        .estado-pendiente { background: #ffc107; color: #000; }
        .estado-en_proceso { background: #17a2b8; color: #fff; }
        .estado-en_produccion { background: #6f42c1; color: #fff; }
        .estado-listo { background: #28a745; color: #fff; }
        .estado-enviado { background: #007bff; color: #fff; }
        .estado-entregado { background: #20c997; color: #fff; }
        .estado-cancelado { background: #dc3545; color: #fff; }
        
        .timeline {
            position: relative;
            padding: 20px 0;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #ff6347;
        }
        .timeline-item {
            position: relative;
            margin-left: 60px;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -38px;
            top: 20px;
            width: 15px;
            height: 15px;
            background: #ff6347;
            border-radius: 50%;
            border: 3px solid #fff;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .timeline-date {
            font-size: 0.85rem;
            color: #888;
        }
        .timeline-estado {
            font-weight: bold;
            color: #ff6347;
        }
        .pedido-info {
            background: linear-gradient(135deg, #ff6347 0%, #ff8c69 100%);
            color: #fff;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .pedido-info h4 {
            margin: 0;
            font-family: 'Pacifico', cursive;
        }
    </style>
</head>
<body>
{% include 'header.html' %}

<main class="info-container">
    <h1 class="titulo"><i class="fas fa-search-location"></i> Rastrear Pedido</h1>
    <p class="bienvenida">Consulta el estado de tu pedido</p>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <div class="card p-4 mb-4">
        <form method="post" action="{{ url_for('rastrear_pedido') }}">
            <div class="row align-items-end">
                <div class="col-md-9">
                    <label for="pedido_id" class="form-label"><i class="fas fa-hashtag"></i> Número de Pedido</label>
                    <input type="number" class="form-control" id="pedido_id" name="pedido_id" 
                           placeholder="Ingrese el número de su pedido" required>
                </div>
                <div class="col-md-3">
                    <button type="submit" class="btn btn-consultar w-100">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                </div>
            </div>
        </form>
    </div>
    
    {% if pedido %}
    <div class="pedido-info">
        <div class="row">
            <div class="col-md-4">
                <h4>Pedido #{{ pedido.id_pedido }}</h4>
            </div>
            <div class="col-md-4">
                <p class="mb-0"><i class="fas fa-calendar"></i> {{ pedido.fecha.strftime('%d/%m/%Y %H:%M') }}</p>
            </div>
            <div class="col-md-4 text-end">
                <span class="estado-badge estado-{{ pedido.estado }}">
                    {{ pedido.estado.replace('_', ' ').title() }}
                </span>
            </div>
        </div>
    </div>
    
    <div class="card p-4 mb-4">
        <h5><i class="fas fa-box"></i> Detalles del Pedido</h5>
        <table class="table">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Precio Unit.</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {% for detalle in pedido.detalles %}
                <tr>
                    <td>{{ detalle.producto.nombre }}</td>
                    <td>{{ detalle.cantidad }}</td>
                    <td>${{ detalle.producto.precio }}</td>
                    <td>${{ detalle.cantidad * detalle.producto.precio }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div class="card p-4">
        <h5><i class="fas fa-history"></i> Historial de Seguimiento</h5>
        
        {% if seguimientos %}
        <div class="timeline">
            {% for seg in seguimientos %}
            <div class="timeline-item">
                <div class="timeline-date">
                    <i class="fas fa-clock"></i> {{ seg.fecha.strftime('%d/%m/%Y %H:%M') }}
                </div>
                <div class="timeline-estado">
                    <span class="estado-badge estado-{{ seg.estado }}">
                        {{ seg.estado.replace('_', ' ').title() }}
                    </span>
                </div>
                {% if seg.comentario %}
                <p class="mb-0 mt-2"><i class="fas fa-comment"></i> {{ seg.comentario }}</p>
                {% endif %}
                {% if seg.empleado %}
                <small class="text-muted">Actualizado por: {{ seg.empleado.usuario.nombre }}</small>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-muted text-center">No hay historial de seguimiento disponible</p>
        {% endif %}
    </div>
    {% endif %}
</main>

{% include 'footer.html' %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
</body>
</html>
